<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>카카오 지도 - 마커 클릭 시 단일 정보창</title>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=bef1fdbfb5b4d0c4519859a35fd0e1c4&autoload=false"></script>
</head>
<body>
  <h2>지도와 주차장 정보</h2>
  <div id="map" style="width:100%; height:600px;"></div>

  <table border="1" style="margin-top:20px;" id="infoTable">
    <tr><th>이름</th><td id="name">-</td></tr>
    <tr><th>주소</th><td id="addr">-</td></tr>
    <tr><th>종류</th><td id="type">-</td></tr>
    <tr><th>요금</th><td id="price">-</td></tr>
    <tr><th>발렛</th><td id="valet">-</td></tr>
  </table>

  <script>
    kakao.maps.load(function () {
      const map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 5
      });

      const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

      const markerPositions = [
        { title: "주차장A", latlng: new kakao.maps.LatLng(37.5665, 126.9780) },
        { title: "광화문", latlng: new kakao.maps.LatLng(37.5759, 126.9769) }
      ];

      markerPositions.forEach(pos => {
        const marker = new kakao.maps.Marker({
          map: map,
          position: pos.latlng,
          title: pos.title
        });

        kakao.maps.event.addListener(marker, 'click', function () {
          infowindow.setContent(`<div style="padding:5px;">${pos.title}</div>`);
          infowindow.open(map, marker);

          // ✅ 서버로 데이터 요청
          fetch(`/map/parking?name=${encodeURIComponent(pos.title)}`)
            .then(res => res.json())
            .then(data => {
            	console.log("📦 받은 데이터:", data);  // 👈 여기를 꼭 확인
              document.getElementById('name').textContent = data.name;
              document.getElementById('addr').textContent = data.addr;
              document.getElementById('type').textContent = data.type;
              document.getElementById('price').textContent = data.price + "원";
              document.getElementById('valet').textContent = data.valet === 1 ? "가능" : "불가능";
            });
        });
      });
    });
  </script>
</body>
</html>
