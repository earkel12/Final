<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ì¹´ì¹´ì˜¤ ì§€ë„ - ë§ˆì»¤ í´ë¦­ ì‹œ ë‹¨ì¼ ì •ë³´ì°½</title>
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=bef1fdbfb5b4d0c4519859a35fd0e1c4&autoload=false"></script>
</head>
<body>
  <h2>ì§€ë„ì™€ ì£¼ì°¨ì¥ ì •ë³´</h2>
  <div id="map" style="width:100%; height:600px;"></div>

  <table border="1" style="margin-top:20px;" id="infoTable">
    <tr><th>ì´ë¦„</th><td id="name">-</td></tr>
    <tr><th>ì£¼ì†Œ</th><td id="addr">-</td></tr>
    <tr><th>ì¢…ë¥˜</th><td id="type">-</td></tr>
    <tr><th>ìš”ê¸ˆ</th><td id="price">-</td></tr>
    <tr><th>ë°œë ›</th><td id="valet">-</td></tr>
  </table>

  <script>
    kakao.maps.load(function () {
      const map = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 5
      });

      const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

      const markerPositions = [
        { title: "ì£¼ì°¨ì¥A", latlng: new kakao.maps.LatLng(37.5665, 126.9780) },
        { title: "ê´‘í™”ë¬¸", latlng: new kakao.maps.LatLng(37.5759, 126.9769) }
      ];

      markerPositions.forEach(pos => {
        const marker = new kakao.maps.Marker({
          map: map,
          position: pos.latlng,
          title: pos.title
        });

        kakao.maps.event.addListener(marker, 'click', function () {
          infowindow.setContent(`<div style="padding:5px;">${pos.title}</div>`);
          infowindow.open(map, marker);

          // âœ… ì„œë²„ë¡œ ë°ì´í„° ìš”ì²­
          fetch(`/map/parking?name=${encodeURIComponent(pos.title)}`)
            .then(res => res.json())
            .then(data => {
            	console.log("ğŸ“¦ ë°›ì€ ë°ì´í„°:", data);  // ğŸ‘ˆ ì—¬ê¸°ë¥¼ ê¼­ í™•ì¸
              document.getElementById('name').textContent = data.name;
              document.getElementById('addr').textContent = data.addr;
              document.getElementById('type').textContent = data.type;
              document.getElementById('price').textContent = data.price + "ì›";
              document.getElementById('valet').textContent = data.valet === 1 ? "ê°€ëŠ¥" : "ë¶ˆê°€ëŠ¥";
            });
        });
      });
    });
  </script>
</body>
</html>
