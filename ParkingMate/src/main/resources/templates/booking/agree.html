<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì•½ê´€ ë™ì˜</title>
  <!-- ë³µì¡í•œ DOM ì¡°ì‘, AJAX, ì´ë²¤íŠ¸ ì²˜ë¦¬ -->
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <!-- ê²°ì œapi -->
  <script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
  <style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  background-color: #EEF1FF;
  margin: 0;
  color: #333;
}

.container {
  background-color: #fff;
  max-width: 800px;
  margin: 60px auto;
  padding: 30px 40px;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.step-indicator {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px; /* ê°„ê²© ì¤„ì´ê¸° */
  font-weight: 500;
  padding: 0 40px; /* ì–‘ìª½ ì—¬ë°± ì£¼ë©´ ê°€ìš´ë°ë³´ë‹¤ ë°”ê¹¥ìœ¼ë¡œ ê¸¸ì–´ ë³´ì„ */
}

.step {
  position: relative;
  flex: 1; /* ê° ë‹¨ê³„ ë„ˆë¹„ ë™ì¼í•˜ê²Œ */
  text-align: center;
  font-size: 20px; /* ì‚¬ì´ ê°„ê²© ì¤„ì´ë ¤ë©´ ê¸€ì”¨ í¬ê¸°ë„ ì‚´ì§ ì¤„ì´ëŠ” ê²Œ ìì—°ìŠ¤ëŸ¬ì›€ */
  padding-bottom: 10px;
}

.step::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 10%;
  width: 80%; /* ê¸€ìë³´ë‹¤ ë” ê¸¸ê²Œ */
  height: 2px;
  background-color: #ccc;
}

.step.active {
  color: #4B55E1;
}

.step.active::after {
  background-color: #4B55E1;
}
.terms {
  border: 1px solid #ddd;
  border-radius: 8px;
  margin-bottom: 15px;
  background-color: #fff;
  overflow: hidden;
}

.terms .flex {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 20px;
  cursor: pointer;
  background-color: #f5f5f5;
}

.terms-title {
  font-weight: bold;
  color: #333;
}

.terms-content {
  display: none;
  padding: 15px 20px;
  font-size: 14px;
  color: #555;
  background-color: #fafafa;
  border-top: 1px solid #ddd;
}

.terms.open .terms-content {
  display: block;
}
/* ëª¨ë‘ ë™ì˜ ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
.agree-all {
  
  padding: 12px 16px;
  border: 2px solid #ddd;
  border-radius: 8px;
  margin-bottom: 20px;
  font-weight: bold;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  color: #333;
}

/* ê²°ì œ í•˜ë‹¨ ì˜ì—­ */
.payment-bar {
  border-top: 1px dashed #aaa;
  padding: 20px;
  margin-top: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #f9faff;
  
}

.payment-bar span {
  font-size: 1.2em;
  font-weight: bold;
  color: #4B55E1;
}

#payBtn {
  background-color: #4B55E1;
  color: white;
  padding: 10px 26px;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.2s;
}

#payBtn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

#payBtn:not(:disabled):hover {
  background-color: #3a44c4;
}
  </style>
</head>
<body>
<th:block th:include="@{/header}"></th:block>
<div class="container">
<div class="step-indicator">
  <div class="step">  ì˜ˆì•½  </div>
  <div class="step active">  ì•½ê´€ë™ì˜  </div>
  <div class="step">  ê²°ì œ  </div>
</div>

	<div class="terms" onclick="toggleTerms(this)">
	  <div class="flex">
	    <span class="terms-title">[í•„ìˆ˜] ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜</span>
	    <label><input type="checkbox" class="agree" id="agree1"> ë™ì˜</label>
	  </div>
	  <div class="terms-content">
	    ë³¸ ì„œë¹„ìŠ¤ëŠ” íšŒì›ì—ê²Œ ì£¼ì°¨ì¥ ì˜ˆì•½, ê²°ì œ, ìœ„ì¹˜ ì•ˆë‚´ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.  
	    íšŒì›ì€ ì„œë¹„ìŠ¤ë¥¼ ì •ìƒì ìœ¼ë¡œ ì´ìš©í•˜ê¸° ìœ„í•´ ì •í™•í•œ ì •ë³´ë¥¼ ì œê³µí•´ì•¼ í•˜ë©°,  
	    ì„œë¹„ìŠ¤ ì´ìš© ì¤‘ ë°œìƒí•˜ëŠ” ë¬¸ì œì— ëŒ€í•œ ì±…ì„ì€ ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.
	  </div>
	</div>
	
	<div class="terms" onclick="toggleTerms(this)">
	  <div class="flex">
	    <span class="terms-title">[í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</span>
	    <label><input type="checkbox" class="agree" id="agree2"> ë™ì˜</label>
	  </div>
	  <div class="terms-content">
	    ìˆ˜ì§‘ í•­ëª©: ì´ë¦„, ì—°ë½ì²˜, ì°¨ëŸ‰ë²ˆí˜¸ ë“±<br>
	    ì´ìš© ëª©ì : ì˜ˆì•½ í™•ì¸, ê³ ê° ì‘ëŒ€, ì„œë¹„ìŠ¤ ì œê³µ<br>
	    ë³´ìœ  ê¸°ê°„: íšŒì› íƒˆí‡´ í›„ 1ë…„ê°„ ë³´ê´€ í›„ íŒŒê¸°
	  </div>
	</div>
	
	<div class="terms" onclick="toggleTerms(this)">
	  <div class="flex">
	    <span class="terms-title">[í•„ìˆ˜] ìœ„ì¹˜ì •ë³´ ì´ìš©ì•½ê´€ ë™ì˜</span>
	    <label><input type="checkbox" class="agree" id="agree3"> ë™ì˜</label>
	  </div>
	  <div class="terms-content">
	    ìœ„ì¹˜ì •ë³´ëŠ” ì•½ì† ì¥ì†Œ ë° ì£¼ì°¨ì¥ ì•ˆë‚´ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°,  
	    ë²•ë ¹ì— ë”°ë¼ í•„ìš”í•œ ê²½ìš°ì— í•œí•˜ì—¬ ì™¸ë¶€ì— ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
	  </div>
	</div>
	
	<div class="terms" onclick="toggleTerms(this)">
	  <div class="flex">
	    <span class="terms-title">[ì„ íƒ] ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜</span>
	    <label><input type="checkbox" id="agree4"> ë™ì˜</label>
	  </div>
	  <div class="terms-content">
	    ì´ë²¤íŠ¸, í• ì¸ ì •ë³´ ë“± ë‹¤ì–‘í•œ í˜œíƒì„ ë¬¸ì ë˜ëŠ” ì´ë©”ì¼ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.  
	    ë™ì˜í•˜ì§€ ì•Šì•„ë„ ì„œë¹„ìŠ¤ ì´ìš©ì— ì œí•œì€ ì—†ìŠµë‹ˆë‹¤.
	  </div>
	</div>

  <hr>

	<!-- âœ… ëª¨ë‘ ë™ì˜ -->
	<div class="agree-all">
	  <label><input type="checkbox" id="checkAll"> ëª¨ë‘ ë™ì˜</label>
	</div>
	
	<!-- âœ… ê²°ì œ í•˜ë‹¨ ì˜ì—­ -->
	<div class="payment-bar">
	  <div>ê²°ì œ ê¸ˆì•¡: <span id="finalPrice" th:text="${total}">0</span> ì›</div>
	  <button id="payBtn" disabled>ê²°ì œí•˜ê¸°</button>
	</div>
</div>
  <script>
    const agreeChecks = document.querySelectorAll('.agree');
    const checkAll = document.getElementById('checkAll');
    const payBtn = document.getElementById('payBtn');

    // ëª¨ë‘ ë™ì˜
    checkAll.addEventListener('change', () => {
      agreeChecks.forEach(chk => chk.checked = checkAll.checked);
      togglePayButton();
    });

    // ê°ê° ì²´í¬ ë³€ê²½ ì‹œ
    agreeChecks.forEach(chk => {
      chk.addEventListener('change', () => {
        checkAll.checked = [...agreeChecks].every(c => c.checked);
        togglePayButton();
      });
    });

    // ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ íŒë‹¨
    function togglePayButton() {
      const allChecked = [...agreeChecks].every(c => c.checked);
      if (allChecked) {
        payBtn.disabled = false;
        payBtn.classList.add("active");
      } else {
        payBtn.disabled = true;
        payBtn.classList.remove("active");
      }
    }

	// ê²°ì œ ë²„íŠ¼ í´ë¦­ ì‹œ
	// === [â­ ê²°ì œ ë¡œì§] ===
	payBtn.addEventListener("click", () => {
	  const finalPrice = parseInt(document.getElementById('finalPrice').textContent.replace(/[^0-9]/g, '') || "0", 10);
	  const IMP = window.IMP;
	  IMP.init("imp84584038"); // ë³¸ì¸ imp í‚¤ë¡œ ëŒ€ì²´
	
	  IMP.request_pay({
	    pg: "kakaopay", 
	    pay_method: "card",
	    merchant_uid: "order_" + new Date().getTime(),
	    name: "ì£¼ì°¨ì¥ ì˜ˆì•½ ê²°ì œ",
	    amount: finalPrice,
	    buyer_email: "ì´ìˆ˜í•œ@naver.com",
	    buyer_name: "ì´ìˆ˜í•œ",
	    buyer_tel: "010-1234-5678",
	    buyer_addr: "ì„œìš¸íŠ¹ë³„ì‹œ",
	    buyer_postcode: "12345"
	  }, function (rsp) {
	    if (rsp.success) {
	        alert("1ì°¨ê²°ì œ ì„±ê³µ!");
	        
	        // ğŸŸ¢ Ajaxë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì— ê²°ì œ ì„±ê³µ ì•Œë¦¬ê¸°
	        $.ajax({
	          url: "/payment",  // ì»¨íŠ¸ë¡¤ëŸ¬ì— POSTë¡œ ì „ì†¡
	          method: "POST",
	          success: function() {
	            location.href = "/";  // ì„±ê³µí•˜ë©´ indexë¡œ ì´ë™
	          },
	          error: function() {
	            alert("ê²°ì œ ì²˜ë¦¬ í›„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨!");
	          }
	        });

	      } else {
	        alert("ê²°ì œ ì‹¤íŒ¨: " + rsp.error_msg);
	      }
	    });
	  });

	function toggleTerms(el) {
	  // í´ë¦­ ì‹œ, í˜„ì¬ í•­ëª©ë§Œ ì—´ê³  ë‚˜ë¨¸ì§€ëŠ” ë‹«ìŒ
	  document.querySelectorAll('.terms').forEach(term => {
	    if (term !== el) term.classList.remove('open');
	  });
	  el.classList.toggle('open');
	}
	</script>
<th:block th:include="@{/footer}"></th:block>
</body>
</html>
