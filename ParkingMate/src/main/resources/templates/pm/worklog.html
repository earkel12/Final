<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>파킹메이트</title>
<th:block th:include="@{/header}"></th:block>
<style>
body {
	font-family: 'Segoe UI', '맑은 고딕', sans-serif;
	background-color: #f5f7fa;
	color: #2c3e50;
	margin: 0;
	padding: 40px 20px;
}

h1 {
	font-size: 28px;
	margin-bottom: 30px;
	border-left: 5px solid #B1B2FF;
	padding-left: 15px;
	color: #1a1a1a;
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-bottom: 25px;
	background-color: white;
	box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
	border-radius: 8px;
	overflow: hidden;
}

th, td {
	padding: 12px 15px;
	text-align: left;
	border-bottom: 1px solid #e1e4f0;
}

th {
	background-color: #f0f1ff;
	color: #555;
	width: 35%;
	vertical-align: middle;
}

td {
	vertical-align: middle;
}

textarea#history {
	width: 100%;
	padding: 10px 12px;
	font-size: 15px;
	border: 1.5px solid #ccc;
	border-radius: 6px;
	box-sizing: border-box;
	resize: vertical; /* 세로로만 크기 조절 가능 */
	min-height: 80px; /* 기본 높이 */
	transition: border-color 0.3s ease;
	font-family: 'Segoe UI', '맑은 고딕', sans-serif;
	color: #2c3e50;
}

textarea#history:focus {
	border-color: #6C72FF;
	outline: none;
	box-shadow: 0 0 6px #aab2ff88;
}

select#bank {
	width: 100%;
	padding: 10px 12px;
	font-size: 15px;
	border: 1.5px solid #ccc;
	border-radius: 6px;
	background-color: #fff;
	color: #2c3e50;
	transition: border-color 0.3s ease;
	appearance: none;
	-webkit-appearance: none;
	-moz-appearance: none;
	background-image:
		url("data:image/svg+xml;utf8,<svg fill='gray' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
	background-repeat: no-repeat;
	background-position: right 12px center;
	background-size: 16px 16px;
	cursor: pointer;
}

select#bank:focus {
	outline: none;
	border-color: #6C72FF;
	box-shadow: 0 0 6px #aab2ff88;
}

input[type="text"] {
	width: 100%;
	padding: 10px 12px;
	font-size: 15px;
	border: 1.5px solid #ccc;
	border-radius: 6px;
	box-sizing: border-box;
	transition: border-color 0.3s ease;
}

input[type="text"]:focus {
	border-color: #6C72FF;
	outline: none;
	box-shadow: 0 0 6px #aab2ff88;
}

button {
	background-color: #6C72FF;
	color: white;
	font-weight: bold;
	font-size: 16px;
	padding: 12px 30px;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	transition: background-color 0.3s ease;
}

button:hover {
	background-color: #555bff;
}

.cancel-button {
	background-color: #AAC4FF;
	color: #1a1a1a;
	margin-left: 12px;
}

.cancel-button:hover {
	background-color: #B1B2FF;
}

td[colspan="2"] {
	text-align: center;
	padding-top: 20px;
}
</style>
</head>
<body>
	<h1>파킹메이트 근무관리</h1>
	<form name="worklog" action="/pm/worklog" method="post"
		enctype="multipart/form-data">
		<table border="1" cellspacing="0" cellpadding="3">
			<tr>
				<th><label for="id">사용자 ID</label></th>
				<td><span th:text="${worklog.id}"></span></td>
			</tr>
			<tr>
				<th><label for="totalServiceCount">총 대행 횟수</label></th>
				<td><span th:text="${totalServiceCount} + '회'"></span></td>
			</tr>
			<tr>
				<th><label for="totalPayCount">총 정산 금액</label></th>
				<td><span th:text="${totalPayCount} + '원'"></span></td>
			</tr>
		</table>
		<br>

		<table border="1" cellspacing="0" cellpadding="5">
			<tbody>
				<tr>
					<th><label for="license">운전면허증 일련번호</label></th>
					<td><input type="text" id="license" name="license" required
						placeholder="예: 01-23-456789-00"
						pattern="^\d{2}-\d{2}-\d{6}-\d{2}$"
						title="예: 01-23-456789-00 형태로 입력하세요."
						th:value="${worklog.license}" oninput="formatLicenseNumber(this)" /></td>
				</tr>

				<tr>
					<th><label for="picture">운전면허증 업로드</label></th>
					<td><input type="file" id="picture" name="pictureFile"
						accept="image/*" onchange="previewImage(event)" /> <br /> <img
						id="preview" th:if="${worklog.picture != null}"
						th:src="@{'/upload/' + ${worklog.picture}}" alt="미리보기"
						style="max-width: 300px; border: 1px solid #ccc;" /></td>
				</tr>
				<tr>
					<th><label for="history">차량 이력</label></th>
					<td><textarea id="history" name="history" rows="3"
							class="styled-textarea" th:text="${worklog.history}"></textarea>
					</td>
				</tr>
				<tr>
					<th><label for="addr">주소</label></th>
					<td><input type="text" id="addr" name="addr"
						th:value="${worklog.addr}"></td>
				</tr>
				<tr>
					<th><label for="bank">은행명</label></th>
					<td><select id="bank" name="bank" required>
							<option value="" th:selected="${worklog.bank == null}">은행
								선택</option>
							<option value="국민은행" th:selected="${worklog.bank == '국민은행'}">국민은행</option>
							<option value="신한은행" th:selected="${worklog.bank == '신한은행'}">신한은행</option>
							<option value="우리은행" th:selected="${worklog.bank == '우리은행'}">우리은행</option>
							<option value="하나은행" th:selected="${worklog.bank == '하나은행'}">하나은행</option>
							<option value="농협은행" th:selected="${worklog.bank == '농협은행'}">농협은행</option>
							<option value="기업은행" th:selected="${worklog.bank == '기업은행'}">기업은행</option>
							<option value="SC제일은행" th:selected="${worklog.bank == 'SC제일은행'}">SC제일은행</option>
							<option value="한국씨티은행" th:selected="${worklog.bank == '한국씨티은행'}">한국씨티은행</option>
							<option value="카카오뱅크" th:selected="${worklog.bank == '카카오뱅크'}">카카오뱅크</option>
							<option value="토스뱅크" th:selected="${worklog.bank == '토스뱅크'}">토스뱅크</option>
							<option value="부산은행" th:selected="${worklog.bank == '부산은행'}">부산은행</option>
							<option value="대구은행" th:selected="${worklog.bank == '대구은행'}">대구은행</option>
							<option value="광주은행" th:selected="${worklog.bank == '광주은행'}">광주은행</option>
							<option value="전북은행" th:selected="${worklog.bank == '전북은행'}">전북은행</option>
							<option value="경남은행" th:selected="${worklog.bank == '경남은행'}">경남은행</option>
							<option value="제주은행" th:selected="${worklog.bank == '제주은행'}">제주은행</option>
							<option value="수협은행" th:selected="${worklog.bank == '수협은행'}">수협은행</option>
							<option value="산업은행" th:selected="${worklog.bank == '산업은행'}">산업은행</option>
							<option value="우체국" th:selected="${worklog.bank == '우체국'}">우체국</option>
					</select></td>
				</tr>
				<tr>
					<th><label for="account">계좌번호</label></th>
					<td><input type="text" id="account" name="account"
						th:value="${worklog.account}" maxlength="20"
						placeholder="계좌번호를 입력하세요" oninput="formatAccountNumber(this)" />
					</td>
				</tr>
				<tr>
					<td colspan="2" align="center">
						<button type="submit">수정</button>
						<button type="button" class="cancel-button"
							onclick="location.href='/parkingmate'">취소</button>
					</td>
				</tr>
			</tbody>
		</table>
	</form>
	<br>
</body>

<script>
function previewImage(event) {
	  const file = event.target.files[0];
	  const preview = document.getElementById('preview');

	  if (file && file.type.startsWith('image/')) {
	    const reader = new FileReader();
	    reader.onload = function(e) {
	      preview.src = e.target.result;    // 기존 이미지 src 교체
	      preview.style.display = 'block'; // 혹시 display:none이면 보이도록
	    };
	    reader.readAsDataURL(file);
	  } else {
	    preview.src = '#';
	    preview.style.display = 'none';   // 이미지가 아니면 숨기기
	  }
	}
	function formatLicenseNumber(input) {
		let value = input.value.replace(/\D/g, '');
		let formatted = '';

		if (value.length <= 2) {
			formatted = value;
		} else if (value.length <= 4) {
			formatted = value.slice(0, 2) + '-' + value.slice(2);
		} else if (value.length <= 10) {
			formatted = value.slice(0, 2) + '-' + value.slice(2, 4) + '-'
					+ value.slice(4);
		} else {
			formatted = value.slice(0, 2) + '-' + value.slice(2, 4) + '-'
					+ value.slice(4, 10) + '-' + value.slice(10, 12);
		}

		input.value = formatted;
	}

	function formatAccountNumber(input) {
		let value = input.value.replace(/\D/g, '');
		let formatted = '';

		if (value.length <= 3) {
			formatted = value;
		} else if (value.length <= 5) {
			formatted = value.slice(0, 3) + '-' + value.slice(3);
		} else if (value.length <= 10) {
			formatted = value.slice(0, 3) + '-' + value.slice(3, 5) + '-'
					+ value.slice(5);
		} else {
			formatted = value;
		}

		input.value = formatted;
	}
	document.addEventListener("DOMContentLoaded", function() {
		const licenseInput = document.getElementById('license');
		const accountInput = document.getElementById('account');

		if (licenseInput && licenseInput.value) {
			formatLicenseNumber(licenseInput);
		}

		if (accountInput && accountInput.value) {
			formatAccountNumber(accountInput);
		}
	});
	document.querySelector('form[name="worklog"]').addEventListener('submit',
			function(e) {

				const licenseInput = document.getElementById('license');
				licenseInput.value = licenseInput.value.replace(/-/g, '');

				const accountInput = document.getElementById('account');
				accountInput.value = accountInput.value.replace(/-/g, '');
			});
</script>
<th:block th:include="@{/footer}"></th:block>
</html>
