<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>파킹메이트 이용현황</title>
  <th:block th:include="@{/header}"></th:block>
  <!-- Kakao 지도 API -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY&autoload=false"></script>

  <style>
    body {
      font-family: 'Segoe UI', '맑은 고딕', sans-serif;
      background-color: #f5f7fa;
      color: #2c3e50;
      margin: 0;
      padding: 40px 20px;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 30px;
      border-left: 5px solid #B1B2FF;
      padding-left: 15px;
      color: #1a1a1a;
    }

    #map {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    a {
      display: inline-block;
      margin-top: 10px;
      color: #6C72FF;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    a:hover {
      color: #555bff;
    }

    @media (max-width: 600px) {
      #map {
        height: 300px;
      }
    }
  </style>

  <!-- usageList를 JS에 주입 -->
  <script th:inline="javascript">
    const usageList = /*[[${usageList}]]*/ [];
  </script>
</head>

<body>
  <h1>파킹메이트 이용현황</h1>
  <div id="map"></div>

  <script>
    kakao.maps.load(function () {
      const mapContainer = document.getElementById('map');
      const mapOption = {
        center: new kakao.maps.LatLng(37.5665, 126.9780),
        level: 5
      };

      const map = new kakao.maps.Map(mapContainer, mapOption);
      const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

      if (usageList.length === 0) {
        alert("예약 중인 주차장이 없습니다.");
        return;
      }

      usageList.forEach(entry => {
        const position = new kakao.maps.LatLng(entry.latitude, entry.longitude);

        const marker = new kakao.maps.Marker({
          map: map,
          position: position,
          title: entry.lotName || entry.addr || "예약 주차장"
        });

        kakao.maps.event.addListener(marker, 'click', function () {
          const content = `<div style="padding:5px;"><b>${entry.lotName ?? "예약 주차장"}</b><br>${entry.addr}</div>`;
          infowindow.setContent(content);
          infowindow.open(map, marker);
        });
      });

      map.setCenter(new kakao.maps.LatLng(usageList[0].latitude, usageList[0].longitude));
    });
  </script>

  <a th:href="@{/parkingmate}">파킹메이트 메인</a>
  <th:block th:include="@{/footer}"></th:block>
</body>
</html>
