<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>파킹메이트 이용현황</title>
<th:block th:include="@{/header}"></th:block>
<!-- ✅ 카카오 지도 SDK -->
<script
	src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=bef1fdbfb5b4d0c4519859a35fd0e1c4&autoload=false"></script>

<style>
body {
	font-family: 'Segoe UI', '맑은 고딕', sans-serif;
	background-color: #f5f7fa;
	color: #2c3e50;
	margin: 0;
	padding: 40px 20px;
}

h1 {
	font-size: 28px;
	margin-bottom: 30px;
	border-left: 5px solid #B1B2FF;
	padding-left: 15px;
	color: #1a1a1a;
}

#map {
	width: 100%;
	height: 400px;
	border: 1px solid #ccc;
	border-radius: 10px;
	margin-bottom: 20px;
}

a {
	display: inline-block;
	margin-top: 10px;
	color: #6C72FF;
	text-decoration: none;
	font-weight: 600;
	transition: color 0.3s ease;
}

a:hover {
	color: #555bff;
}

@media ( max-width : 600px) {
	#map {
		height: 300px;
	}
}
</style>
</head>
<script th:inline="javascript">
  /*<![CDATA[*/
  const usageList = /*[[${usageList}]]*/ [];
  if (usageList.length === 0) {
    alert('예약 내역이 없습니다.');
  }
  /*]]>*/
</script>
<body>
	<h1>파킹메이트 이용현황</h1>
	<div id="map"></div>

	<script>
kakao.maps.load(function () {
  const mapContainer = document.getElementById('map'); 
  const mapOption = {
    center: new kakao.maps.LatLng(usageList[0].pmlatitude, usageList[0].pmlongitude),
    level: 5
  };

  const map = new kakao.maps.Map(mapContainer, mapOption);

  // 출발지 마커 (파킹메이트 위치)
  const startPos = new kakao.maps.LatLng(usageList[0].pmlatitude, usageList[0].pmlongitude);
  const startMarker = new kakao.maps.Marker({
    map: map,
    position: startPos,
    title: '파킹메이트 위치'
  });

  // 도착지 마커 (유저 위치)
  const endPos = new kakao.maps.LatLng(usageList[0].ulatitude, usageList[0].ulongitude);
  const endMarker = new kakao.maps.Marker({
    map: map,
    position: endPos,
    title: '유저 위치'
  });

  // 길찾기 서비스 객체 생성
  const directionsService = new kakao.maps.services.Directions();

  // 길찾기 요청 (출발지→도착지)
  directionsService.route({
    origin: startPos,
    destination: endPos,
    waypoints: [],
    travelMode: kakao.maps.services.TravelMode.DRIVING // 자동차 경로
  }, function(result, status) {
    if (status === kakao.maps.services.Status.OK) {
      // 경로 좌표 배열
      const routeLinePath = [];

      // result.routes[0].sections 안에 경로 상세 정보가 들어있음
      result.routes[0].sections.forEach(section => {
        section.path.forEach(latlng => {
          routeLinePath.push(new kakao.maps.LatLng(latlng.lat, latlng.lng));
        });
      });

      // 지도에 경로 polyline 표시
      const polyline = new kakao.maps.Polyline({
        map: map,
        path: routeLinePath,
        strokeWeight: 5,
        strokeColor: '#4A90E2',
        strokeOpacity: 0.7,
        strokeStyle: 'solid'
      });

      // 지도의 중심을 출발지로 맞춤
      map.setCenter(startPos);
    } else {
      alert('경로를 찾을 수 없습니다.');
    }
  });
});
</script>
	<a th:href="@{/parkingmate}">파킹메이트 메인</a>
	<th:block th:include="@{/footer}"></th:block>
</body>
</html>
