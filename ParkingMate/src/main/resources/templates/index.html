<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ParkingMate 메인</title>
  <!-- ✅ 카카오 지도 SDK -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=bef1fdbfb5b4d0c4519859a35fd0e1c4&autoload=false"></script>
 
 <style>
  /* 메뉴바 스타일 */
  #floatingNav {
    display: none; /* 초기에는 숨김 */
    position: fixed;
    top: 0;
    left: 50%;
    width:80%;
    height:30px;
    transform: translateX(-50%);
    background: white;
    border: 1px solid #ccc;
    border-radius: 30px;
    padding: 8px 20px;
    z-index: 999;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  #floatingNav ul {
  display: flex;
  justify-content: center; /* ✅ 가운데 정렬 */
  align-items: center;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 40px; /* ✅ 항목 간 간격 (li 사이 간격) */
  }

  #floatingNav li {
    margin: 0 15px;
  }

  #floatingNav a {
    text-decoration: none;
    color: #333;
    font-weight: 500;
  }

  #floatingNav a:hover {
    text-decoration: underline;
  }
</style>
<script>
  window.addEventListener('scroll', function () {
    const header = document.querySelector('.header');
    const nav = document.getElementById('floatingNav');

    if (window.scrollY > header.offsetHeight) {
      nav.style.display = 'block';
    } else {
      nav.style.display = 'none';
    }
  });
  
function showLoginCheck() {
	alert('문의하기는 로그인 후 이용해주세요.');
	location.href = 'login';
}
</script>
</head>
<body>
<th:block th:include = "@{/header}"></th:block>
<nav id="floatingNav">
  <ul>
    <li><a href="company">회사소개</a></li>
    <li><a href="reser">예약하기</a></li>
    <li><a href="notice">공지사항</a></li>
    <li><a href="community">커뮤니티</a></li>
    <li><a href="mypageMain">마이페이지</a></li>
  </ul>
</nav>




<hr>

<!-- 내비게이션 -->
<a href="notice">공지사항</a><br>
<a href="faq">자주하는 질문</a><br>
<a th:if="${session.sid == null}" th:href="@{/login}" onclick = "showLoginCheck()">문의하기</a>
<a th:if="${session.sid != null and session.sid == 'admin'}" th:href="@{/ask}">문의하기</a>
<a th:if="${session.sid != null and session.sid != 'admin'}" th:href="@{/askWrite}">문의하기</a>
<br>
<a href="register">회원가입</a><br>
<a href="parkingmate">파킹메이트</a><br>
<a href="community">커뮤니티</a><br>

<hr>

<!-- ✅ 지도 섹션 -->
<h2>주차장 지도</h2>
<div id="map" style="width:100%; height:600px;"></div>

<table border="1" style="margin-top:20px;" id="infoTable">
  <tr><th>이름</th><td id="name">-</td></tr>
  <tr><th>주소</th><td id="addr">-</td></tr>
  <tr><th>종류</th><td id="type">-</td></tr>
  <tr><th>요금</th><td id="price">-</td></tr>
  <tr><th>발렛</th><td id="valet">-</td></tr>
</table>
<a href="booking">예약하기</a><br>

<script>
  kakao.maps.load(function () {
    const mapContainer = document.getElementById('map');
    const mapOption = {
      center: new kakao.maps.LatLng(37.5665, 126.9780),
      level: 5
    };

    const map = new kakao.maps.Map(mapContainer, mapOption);
    const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

    // ✅ 주차장 목록 요청
    fetch('/map/list')
      .then(response => response.json())
      .then(data => {
        data.forEach(parking => {
          const position = new kakao.maps.LatLng(parking.latitude, parking.longitude);
          const marker = new kakao.maps.Marker({
            map: map,
            position: position,
            title: parking.name
          });

          kakao.maps.event.addListener(marker, 'click', function () {
            const content = `<div style="padding:5px;"><b>${parking.name}</b><br>${parking.addr}</div>`;
            infowindow.setContent(content);
            infowindow.open(map, marker);
            
            // 주차장 정보를 서버로 전달
            fetch(`/map/setSession?idx=${parking.idx}&name=${parking.name}&price=${parking.price}&price2=${parking.price2}`)
            .then(res => console.log("Session 저장 완료"));

            // 표 정보 업데이트
            document.getElementById('name').innerText = parking.name;
            document.getElementById('addr').innerText = parking.addr;
            document.getElementById('type').innerText = parking.type;
            document.getElementById('price').innerText = `${parking.price}원`;
            document.getElementById('valet').innerText = parking.valet === 1 ? '가능' : '불가능';
          });
        });
      })
      .catch(err => console.error(err));
  });
</script>
<th:block th:include = "@{/footer}"></th:block>
</body>
</html>