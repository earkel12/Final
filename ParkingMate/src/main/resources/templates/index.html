<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ParkingMate ë©”ì¸</title>
  <!-- âœ… ì¹´ì¹´ì˜¤ ì§€ë„ SDK -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=bef1fdbfb5b4d0c4519859a35fd0e1c4&autoload=false"></script>
 
<style>
/* ë°°ê²½ ì „ì²´ */
body {
  margin: 0;
  padding: 0;
  background-color: #EEF1FF;
  font-family: 'Pretendard', sans-serif;
  color: #333;
}

/* ê²€ìƒ‰ ë°” */
.search-bar {
  margin: 20px auto;
  text-align: center;
}

.search-bar input[type="text"] {
  padding: 10px;
  width: 300px;
  border: 1px solid #ccc;
  border-radius: 8px;
}

.search-bar button {
  background-color: #D2DAFF;
  border: none;
  color: #555879;
  padding: 10px 18px;
  font-weight: bold;
  border-radius: 8px;
  margin-left: 10px;
  cursor: pointer;
  transition: 0.2s;
}

.search-bar button:hover {
  background-color: #AAC4FF;
}

/* ì§€ë„ + ì •ë³´ ë°•ìŠ¤ ë ˆì´ì•„ì›ƒ */
.map-container {
  display: flex;
  gap: 20px;
  padding: 0 30px 30px;
}

/* ì§€ë„ */
#map {
  width: 70%;
  height: 600px;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

/* ì •ë³´ ë°•ìŠ¤ */
#infoBox {
  width: 30%;
  height:500px;
  background: #F8F9FF;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.1);
  font-size: 15px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

/* ì •ë³´ í…Œì´ë¸” */
#infoTable {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 60px;
}



#infoTable th,
#infoTable td {
  padding: 8px;
  padding-top: 40px;
  margin: 0 30px;
  text-align: left;
  font-size: 20px;
  border-bottom: 1px solid #ddd;
}

/* ì˜ˆì•½ ë²„íŠ¼ */
.reserve-btn {
  display: block;
  text-align: center;
  padding: 12px;
  background-color: #D2DAFF;
  color: #555879;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  cursor: pointer;
  text-decoration: none;
  transition: background-color 0.2s;
  margin-bottom:20px;
}

.reserve-btn:hover {
  background-color: #AAC4FF;
}
/* ì„œë¹„ìŠ¤ ë°•ìŠ¤ */
.about-services h2 {
  font-size: 24px;
  color: #AAC4FF;
  margin-bottom: 30px;
}

.about-services {
  display: flex;
  justify-content: center;
  gap: 40px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

.service-box {
  width: 280px;
  background: #f9f9f9;
  border-radius: 16px;
  padding: 30px 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  transition: transform 0.3s ease;
  text-align: center;
}

.service-box:hover {
  transform: translateY(-5px);
}

.service-box img {
  width: 60px;
  height: 60px;
  margin-bottom: 16px;
}

.service-box h3 {
  font-size: 18px;
  color: #222;
  margin-bottom: 12px;
}

.service-box p {
  font-size: 14px;
  color: #666;
  line-height: 1.5;
}
.about-section {
  max-width: 1100px;
  margin: 0 auto;
  padding: 60px 20px;
  text-align: center;
}

.about-title {
  font-size: 36px;
  font-weight: bold;
  color: #471396;
  margin-bottom: 24px;
}

.about-description {
  font-size: 18px;
  line-height: 1.6;
  color: #444;
  margin-bottom: 60px;
}
</style>
<script>
  /*window.addEventListener('scroll', function () {
    const header = document.querySelector('.header');
    const nav = document.getElementById('floatingNav');

    if (window.scrollY > header.offsetHeight) {
      nav.style.display = 'block';
    } else {
      nav.style.display = 'none';
    }
  });*/
  
function showLoginCheck() {
	alert('ë¬¸ì˜í•˜ê¸°ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.');
	location.href = 'login';
}
</script>
</head>
<body>
<th:block th:include = "@{/header}"></th:block>

<!-- ìƒë‹¨ ë©”ë‰´ -->
<style>
/* ìƒë‹¨ ë©”ë‰´ë°” */
#floatingNav {
  width: 100%;
  background-color: #B1B2FF;
  padding: 15px 0;
  display: flex;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

#floatingNav ul {
  display: flex;
  gap: 50px;
  list-style: none;
  margin: 0;
  padding: 0;
}

#floatingNav a {
  text-decoration: none;
  color: white;
  font-weight: 600;
  font-size: 16px;
  padding: 8px 12px;
  border-radius: 10px;
  transition: background 0.2s;
}

#floatingNav a:hover {
  background-color: #AAC4FF;
}
</style>
<nav id="floatingNav" th:if="${session.sid == 'admin'}">
  <ul>
    <li><a href="companyProfile">íšŒì‚¬ì†Œê°œê´€ë¦¬</a></li>
    <li><a href="">íšŒì›ê´€ë¦¬</a></li>
    <li><a href="parkingLotRegister">ì£¼ì°¨ì¥ê´€ë¦¬</a></li>
    <li><a href="notice">ê³µì§€ì‚¬í•­ê´€ë¦¬</a></li>
    <li><a href="faq">FAQê´€ë¦¬</a></li>
    <li><a href="ask">ë¬¸ì˜ë‹µë³€</a></li>
    <li><a href="comList">ì»¤ë®¤ë‹ˆí‹°</a></li>
  </ul>
</nav>
<nav id="floatingNav" th:if="${session.sid != 'admin'}">
  <ul>
    <li><a href="companyProfile">íšŒì‚¬ì†Œê°œ</a></li>
    <li><a href="search">ì˜ˆì•½í•˜ê¸°</a></li>
    <li><a href="mateUsagesStatus">ì´ìš©í˜„í™©</a></li>
    <li><a href="notice">ê³µì§€ì‚¬í•­</a></li>
    <li><a href="community">ì»¤ë®¤ë‹ˆí‹°</a></li>
    <li><a href="mypageMain">ë§ˆì´í˜ì´ì§€</a></li>
  </ul>
</nav>



<hr>

<!-- ë‚´ë¹„ê²Œì´ì…˜ 
<a href="notice">ê³µì§€ì‚¬í•­</a><br>
<a href="faq">ìì£¼í•˜ëŠ” ì§ˆë¬¸</a><br>
<a th:if="${session.sid == null}" th:href="@{/login}" onclick = "showLoginCheck()">ë¬¸ì˜í•˜ê¸°</a>
<a th:if="${session.sid != null and session.sid == 'admin'}" th:href="@{/ask}">ë¬¸ì˜í•˜ê¸°</a>
<a th:if="${session.sid != null and session.sid != 'admin'}" th:href="@{/askWrite}">ë¬¸ì˜í•˜ê¸°</a><br>
<a href="register">íšŒì›ê°€ì…</a><br>
<a href="parkingmate">íŒŒí‚¹ë©”ì´íŠ¸</a><br>
<a href="community">ì»¤ë®¤ë‹ˆí‹°</a><br>
<a th:if = "${session.sid == 'admin'}" href = "parkingLotRegister">ì£¼ì°¨ì¥ ë“±ë¡</a>
<hr>-->

<!-- âœ… ì§€ë„ ì„¹ì…˜ -->
  <!-- ê²€ìƒ‰ì°½ -->
  <div class="search-bar">
    <input id="searchInput" type="text" placeholder="ì§€ì—­ ë˜ëŠ” ì£¼ì°¨ì¥ ì´ë¦„ ì…ë ¥">
    <button id="searchBtn">ê²€ìƒ‰</button>
  </div>
<div class="map-container">
  <div id="map"></div>

  <div id="infoBox">
    <table id="infoTable">
      <tr><th>ì´ë¦„</th><td id="name">-</td></tr>
      <tr><th>ì£¼ì†Œ</th><td id="addr" style="font-size: 15px;">-</td></tr>
      <tr><th>ì¢…ë¥˜</th><td id="type">-</td></tr>
      <tr><th>ê°€ëŠ¥/ì „ì²´</th><td><label id="count">-</label>/<label id="place">-</label></td></tr>
      <tr><th>ìš”ê¸ˆ</th><td id="price">-</td></tr>
      <tr><th>ë°œë ›</th><td id="valet">-</td></tr>
    </table>
    <button id="reserveBtn" class="reserve-btn">ì˜ˆì•½í•˜ê¸°</button>
  </div>
</div>
<section class="about-section">
    <h1 class="about-title">ìš°ë¦¬ëŠ” ê³µê°„ì„ ì°¾ê³ , ë‚˜ëˆ„ê³ , íš¨ìœ¨í™”í•©ë‹ˆë‹¤</h1>
    <p class="about-description">
      ParkingMateëŠ” ë„ì‹¬ì˜ ì£¼ì°¨ë‚œì„ í•´ê²°í•˜ê¸° ìœ„í•´<br>
      ë¹„ì–´ìˆëŠ” ì£¼ì°¨ ê³µê°„ì„ ë°œêµ´í•˜ê³ , ì‚¬ìš©ì ê°„ ê³µìœ í•˜ë©°,<br>
     íŠ¹íˆ ë°”ìœ ë„ì‹¬ ì†ì—ì„œ ì£¼ì°¨ ëŒ€ê¸° ì‹œê°„ì„ ì¤„ì´ê³ ,<br>
    ì˜¤ë˜ ê¸°ë‹¤ë¦´ ì‹œê°„ì´ ë¶€ì¡±í•œ ë¶„ë“¤ì„ ìœ„í•œ ë¹ ë¥´ê³  í¸ë¦¬í•œ ì ë¬¸ ì£¼ì°¨ ëŒ€í–‰ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
    </p>
</section>
    <div class="about-services">
      <h2>ğŸš— ì£¼ìš” ì„œë¹„ìŠ¤</h2>
      <div class="service-box">
        <img src="/img/parkingnusiness.png" alt="ì£¼ì°¨ì¥ ê³µìœ  ì•„ì´ì½˜">
        <h3>ì£¼ì°¨ì¥ ê³µìœ </h3>
        <p>ë‚¨ëŠ” ì£¼ì°¨ ê³µê°„ì„ ë“±ë¡í•˜ê³  í•„ìš”í•œ ì‚¬ìš©ìì—ê²Œ ì‹œê°„ ë‹¨ìœ„ë¡œ ê³µìœ í•©ë‹ˆë‹¤.</p>
      </div>
      <div class="service-box">
        <img src="/img/Pm.png" alt="ì£¼ì°¨ ëŒ€í–‰ ì•„ì´ì½˜">
        <h3>ì£¼ì°¨ ëŒ€í–‰</h3>
        <p>ì´ìš©ìê°€ ì°¨ëŸ‰ì„ ë§¡ê¸°ë©´, ì „ë¬¸ ê¸°ì‚¬ê°€ ëŒ€ì‹  ì£¼ì°¨ ë° ë°˜í™˜ì„ ë„ì™€ë“œë¦½ë‹ˆë‹¤.</p>
      </div>
      <div class="service-box">
        <img src="/img/parkingLot.png" alt="ì£¼ì°¨ì¥ ì •ë³´ ì•„ì´ì½˜">
        <h3>ì£¼ì°¨ì¥ ì •ë³´</h3>
        <p>ë‚´ ì£¼ë³€ ì£¼ì°¨ì¥, ê°€ê²©, í˜¼ì¡ë„ ë“± ì‹¤ì‹œê°„ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>
      </div>
    </div>
<script>
  kakao.maps.load(function () {
    const mapContainer = document.getElementById('map');
    const mapOption = {
      center: new kakao.maps.LatLng(37.558103628641774, 126.92329387484676),
      level: 5
    };

    const map = new kakao.maps.Map(mapContainer, mapOption);
    const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

    let markers = [];

    function clearMarkers() {
      markers.forEach(marker => marker.setMap(null));
      markers = [];
    }

    function loadParkings(searchName = "") {
      const url = searchName
        ? `/map/search?name=${encodeURIComponent(searchName)}`
        : '/map/list';
		
      fetch(url)
        .then(response => response.json())
        .then(data => {
          clearMarkers(); // ê¸°ì¡´ ë§ˆì»¤ ì œê±°

          data.forEach(parking => {
            const position = new kakao.maps.LatLng(parking.latitude, parking.longitude);
            const marker = new kakao.maps.Marker({
              map: map,
              position: position,
              title: parking.name
            });
            markers.push(marker);

            kakao.maps.event.addListener(marker, 'click', function () {
            	  const content = `<div style="padding:5px;"><b>${parking.name}</b><br>${parking.addr}</div>`;
            	  infowindow.setContent(content);
            	  infowindow.open(map, marker);

            	  fetch(`/map/setSession?idx=${parking.idx}&name=${parking.name}&price=${parking.price}&price2=${parking.price2}`)
            	    .then(res => console.log("Session ì €ì¥ ì™„ë£Œ"));

            	  document.getElementById('name').innerText = parking.name;
            	  document.getElementById('addr').innerText = parking.addr;
            	  document.getElementById('type').innerText = parking.type;
            	  document.getElementById('place').innerText = parking.maxnum;
            	  document.getElementById('price').innerText = `${parking.price}ì›`;
            	  document.getElementById('valet').innerText = parking.valet === 1 ? 'ê°€ëŠ¥' : 'ë¶ˆê°€ëŠ¥';

            	  // âœ… ì£¼ì°¨ ì˜ˆì•½ ìˆ˜ API í˜¸ì¶œí•˜ì—¬ count ê°’ í‘œì‹œ
            	  fetch(`/map/count?idx=${parking.idx}`)
            	    .then(res => res.json())
            	    .then(count => {
            	      document.getElementById('count').innerText = `${parking.maxnum - count}`;
            	    })
            	    .catch(err => {
            	      document.getElementById('count').innerText = '-';
            	      console.error("ì˜ˆì•½ ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨", err);
            	});
            });
          });
        })
        .catch(err => console.error(err));
      

    }
	

    // ìµœì´ˆ ì „ì²´ ì£¼ì°¨ì¥ ë¡œë”©
    loadParkings();

    // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById('searchBtn').addEventListener('click', () => {
   	  const keyword = document.getElementById('searchInput').value.trim();
   	  if (keyword !== "") {
   	    window.location.href = `/search?keyword=${encodeURIComponent(keyword)}`;
   	  }
   	});
    
    
  });
</script>
<script th:inline="javascript">
//ì˜ˆì•½ ë²„íŠ¼ í´ë¦­
/*<![CDATA[*/
  const sid = /*[[${session.sid}]]*/ null;

  document.addEventListener('DOMContentLoaded', function () {
    const reserveBtn = document.getElementById('reserveBtn');

    if (reserveBtn) {
      reserveBtn.addEventListener('click', function () {
        const selectedName = document.getElementById('name').innerText;
        const countText = document.getElementById('count').innerText;
        const availableCount = parseInt(countText);

        if (!sid) {
          alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          location.href = '/login';
          return;
        }

        if (selectedName === '-' || selectedName === '') {
          alert('ë¨¼ì € ì£¼ì°¨ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        if (!isNaN(availableCount) && availableCount === 0) {
          alert('ë§Œì°¨ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì£¼ì°¨ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
          return;
        }

        location.href = 'booking';
      });
    }
  });
/*]]>*/
</script>
<th:block th:include = "@{/footer}"></th:block>
</body>
</html>